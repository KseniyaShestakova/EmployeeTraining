# Описание
Данный проект имеет следующую функциональность:
* Работа с базой данных для контроля обучения сотрудников преприятий. 
* Поддержка сущностей, хранящих информацию о физических и юридических лицах, контрактах на обучение, учебных курсах (предметах), инструкторах и оплате договоров.
* Автоматизация контроля хранимой информации (поддержка триггеров, обрабатывающих добавляемый данные).

# Содержание проекта

## models
Концептуальная, логическая и физическая модели.

## scripts
Скрипты для оформления базы данных и последующей работы с ней.
#### Сложные запросы 
* **cq1.sql** - выделить номера договоров, которые были оплачены хотя бы 1 раз, причем каждая оплата производилась юридическим лицом (так можно определить, кто учится "на бюджете") 
* **cq2.sql** - для каждой квитанции оплаты выяснить, было ли в этот раз внесено меньше или больше денег, чем в среднем за тот же договор (AVG)
* **cq3.sql** - для каждой программы и каждого курса таких, что этот курс - часть данной программы, посчитать долю продолжительности курса от суммарной продолжительности программы (SUM, CTE)
* **cq4.sql** - для каждого физ. лица, работавшего инструктором, найти его первое, второе и т.д. места работы как инструктора (RANK) 
* **cq5.sql** - для каждой записи в таблице инструкторов найти следующую (по starttime), т.е. выделить следующее место работы инструктора и начало работы на этом месте (LEAD)
* **cq6.sql** - для каждого физ. лица, имевшего контракты на обучение и ни разу не отчисленного, найти количество заключенных им контрактов на обучение
#### Представления
**1.** Таблица физических лиц, с сокрытием номера паспорта. \
**2.** Таблица физических лиц, в которой указано ФИО и его склонения. \
**3.** Таблица договоров на обучения, с заменой person_id на ФИО , заменой company_id на название компании, program_id на название и направление программы. \
**4.** Представление для программ, где для каждой программы указано количество и суммарная продолжительность входящих в нее курсов. \
**5.** Таблица учебных предметов, в которой для каждого предмета указано ФИО текущего инструктора по этому предмету. \
**6.** Таблица, в которой для каждого имеющего договор(ы) на обучение физ. лица указано количество его договоров, имеющих статус учится/выпущен/отчислен.

#### Хранимые процедуры
**1.** По ФИО пользователя получить список его актуальных договоров (т.е. тех, у которых статус "учится"). \
**2.** По названию программы получить список из названий предметов, входящих в эту программу, с указанием продолжительности в учебных часах и доли от суммарного количества часов. Для каждого предмета вывести суммарное количество часов на предметы по тому же направлению. \


#### Триггеры
**1.** Триггер для автоматического подсчета id в каждой из таблиц (чтобы пользователь указывал только осмысленные поля). Для таблиц без SCD.- INSERT \
**2.** Триггер для автоматического подсчета полей id, is_current (для инструкторов и связей программа-предмет) и изменения предыдущей записи для SCD таблиц. - INSERT


## tests
Тесты для сложных запросов и хранимого кода.
